[[jdbc.domain-driven-design]]
= 领域驱动设计与关系型数据库

Spring Data 的所有模块都受到领域驱动设计（Domain Driven Design）中“`仓库（repository）`”、“`聚合（aggregate）`”和“`聚合根（aggregate root）`”等概念的启发。  
这些概念对 Spring Data JDBC 尤为重要，因为它们在某种程度上与操作关系型数据库的传统做法是相悖的。

**聚合** 是一组实体的集合，保证在对该聚合进行原子性变更时始终处于一致状态。  
一个经典的例子是带有 `OrderItems`（订单项）的 `Order`（订单）。当发生变更时，`Order` 上的某个属性（例如 `numberOfItems`，即订单项数量）会始终保持与实际 `OrderItems` 数量的一致性。

跨聚合之间的引用并不要求时刻保持一致，但系统会保证它们最终达到一致状态。

每个聚合有且仅有一个 **聚合根**，它是该聚合中的一个实体。  
所有对聚合的操作都只能通过聚合根上的方法来进行，这些操作即前述的原子性变更。

**仓库（Repository）** 是对持久化存储的一种抽象，其行为类似于某种特定类型聚合的集合。  
对于一般的 Spring Data 模块而言，这意味着你应当为每种聚合根定义一个 `Repository`。  
而对于 Spring Data JDBC 来说，这还意味着：从一个聚合根可达的所有实体都被视为该聚合的一部分。  
Spring Data JDBC 假定只有聚合根才持有指向存储非根实体表的外键，其他实体不会直接引用这些非根实体。

WARNING: 在当前实现中，Spring Data JDBC 会删除并重新创建聚合根所引用的实体。

你可以用自己的实现覆盖仓库方法，以符合你自己的数据库设计和工作风格。