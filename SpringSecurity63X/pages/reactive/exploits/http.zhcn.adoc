[[webflux-http]]
= HTTP

所有基于 HTTP 的通信都应通过 xref:features/exploits/http.adoc#http[使用 TLS] 进行保护。

本节介绍如何使用 WebFlux 特有的功能来辅助 HTTPS 的使用。

[[webflux-http-redirect]]
== 重定向到 HTTPS

如果客户端使用 HTTP 而非 HTTPS 发起请求，你可以配置 Spring Security 将其重定向至 HTTPS。

以下 Java 配置会将所有 HTTP 请求重定向到 HTTPS：

.重定向到 HTTPS
[tabs]
======
Java::
+
[source,java,role="primary"]
----
@Bean
SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) {
	http
		// ...
		.redirectToHttps(withDefaults());
	return http.build();
}
----

Kotlin::
+
[source,kotlin,role="secondary"]
----
@Bean
fun springSecurityFilterChain(http: ServerHttpSecurity): SecurityWebFilterChain {
    return http {
        // ...
        redirectToHttps { }
    }
}
----
======

你可以将该配置包裹在 `if` 语句中，仅在生产环境中启用。  
或者，你也可以根据请求中的某个特性（例如仅在生产环境中存在的特定属性）来判断是否开启此功能。  
例如，如果生产环境添加了一个名为 `X-Forwarded-Proto` 的请求头，则应使用以下 Java 配置：

.当存在 X-Forwarded 时重定向到 HTTPS
[tabs]
======
Java::
+
[source,java,role="primary"]
----
@Bean
SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) {
	http
		// ...
		.redirectToHttps(redirect -> redirect
			.httpsRedirectWhen(e -> e.getRequest().getHeaders().containsKey("X-Forwarded-Proto"))
		);
	return http.build();
}
----

Kotlin::
+
[source,kotlin,role="secondary"]
----
@Bean
fun springSecurityFilterChain(http: ServerHttpSecurity): SecurityWebFilterChain {
    return http {
        // ...
        redirectToHttps {
            httpsRedirectWhen {
                it.request.headers.containsKey("X-Forwarded-Proto")
            }
        }
    }
}
----
======

[[webflux-hsts]]
== 严格传输安全（Strict Transport Security）

Spring Security 支持 xref:servlet/exploits/headers.adoc#servlet-headers-hsts[严格传输安全（HSTS）]，并默认启用该功能。

[[webflux-http-proxy-server]]
== 代理服务器配置

Spring Security 可与 xref:features/exploits/http.adoc#http-proxy-server[代理服务器集成]。