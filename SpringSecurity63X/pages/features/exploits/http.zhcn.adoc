[[http]]
= HTTP

所有基于 HTTP 的通信，包括 https://www.troyhunt.com/heres-why-your-static-website-needs-https/[静态资源]，都应通过使用 TLS 来进行保护，参见 https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html[使用 TLS 的最佳实践]。

作为一个框架，Spring Security 并不直接处理 HTTP 连接，因此它本身并不直接提供对 HTTPS 的支持。  
然而，它提供了多个功能来协助正确使用 HTTPS。

[[http-redirect]]
== 重定向到 HTTPS

当客户端使用 HTTP 时，你可以在 xref:servlet/exploits/http.adoc#servlet-http-redirect[Servlet] 和 xref:reactive/exploits/http.adoc#webflux-http-redirect[WebFlux] 环境中配置 Spring Security 将请求重定向到 HTTPS。

[[http-hsts]]
== 严格传输安全（Strict Transport Security）

Spring Security 支持 xref:features/exploits/headers.adoc#headers-hsts[HTTP 严格传输安全（HSTS）]，并且默认启用该功能。

[[http-proxy-server]]
== 代理服务器配置

在使用代理服务器时，必须正确配置应用程序。  
例如，许多应用会使用负载均衡器，它接收来自 `\https://example.com/` 的请求，并将其转发到位于 `\https://192.168.0.107` 的应用服务器。  
如果没有正确配置，应用服务器将无法感知负载均衡器的存在，而是认为客户端直接请求了 `\https://192.168.0.107:8080`。

为了解决这个问题，可以使用 https://tools.ietf.org/html/rfc7239[RFC 7239] 来表明正在使用负载均衡器。  
为了让应用感知到这一点，你需要配置应用服务器以识别 `X-Forwarded` 头部信息。  
例如，Tomcat 使用 https://tomcat.apache.org/tomcat-10.1-doc/api/org/apache/catalina/valves/RemoteIpValve.html[`RemoteIpValve`]，而 Jetty 使用 https://eclipse.dev/jetty/javadoc/jetty-11/org/eclipse/jetty/server/ForwardedRequestCustomizer.html[`ForwardedRequestCustomizer`]。  
此外，Spring 用户也可以选择使用 Servlet 栈的 https://docs.spring.io/spring-framework/reference/web/webmvc/filters.html#filters-forwarded-headers[`ForwardedHeaderFilter`] 或响应式栈的 https://docs.spring.io/spring-framework/reference/web/webflux/reactive-spring.html#webflux-forwarded-headers[`ForwardedHeaderTransformer`]。

使用 Spring Boot 的用户可以通过 `server.forward-headers-strategy` 属性来配置应用行为。更多详细信息，请参阅 https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto.webserver.use-behind-a-proxy-server[Spring Boot 官方文档]。