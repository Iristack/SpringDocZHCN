= Spring Session

Rob Winch；Vedran Pavić；Jay Bryant；Eleftheria Stein-Kousathana

:doctype: book
:indexdoc-tests: {docs-test-dir}docs/IndexDocTests.java
:websocketdoc-test-dir: {docs-test-dir}docs/websocket/

[[abstract]]
Spring Session 提供了用于管理用户会话信息的 API 及其实现。

[[introduction]]
Spring Session 提供了用于管理用户会话信息的 API 和实现，同时使支持集群会话变得非常简单，且不依赖于特定的应用容器解决方案。它还提供了与以下功能的透明集成：

* xref:http-session.adoc#httpsession[HttpSession]：以与应用容器无关的方式替换 `HttpSession`，并支持通过请求头传递会话 ID，从而更好地支持 RESTful API。
* xref:web-socket.adoc#websocket[WebSocket]：在接收 WebSocket 消息时保持 `HttpSession` 处于活动状态。
* xref:web-session.adoc#websession[WebSession]：以与应用容器无关的方式替换 Spring WebFlux 的 `WebSession`。

== 理解 Spring Session 解决的问题

当用户与 Web 应用程序交互时，服务器会创建一个会话来跟踪其活动。该会话可能存储诸如用户偏好、登录状态和购物车内容等信息。然而，在分布式环境中，会话可能会带来问题，因为它们通常存储在服务器内存中。

为了更好地理解 Spring Session 所解决的问题，我们先来看下面的示意图：

.内存中的会话
image::inmemory-sessions.png[In-Memory Sessions]

在上图中，每个 Spring 应用程序都将自己的会话存储在只有自身可访问的位置（通常是服务器内存）。但在分布式环境中这会成为一个问题。例如，如果 Spring App #2 接收到一个包含 Session #3 的请求，由于该会话数据存储在 Spring App #1 的内存中，Spring App #2 将无法读取该会话数据。为了解决这个问题，我们需要实现某种共享会话存储机制，如下图所示：

.共享会话存储
image::shared-session-storage.png[Shared Session Storage]

通过上述设置，所有能够访问会话存储的应用程序都可以共享这些会话。

Spring Session 在应用程序和会话管理之间提供了一层抽象。它允许将会话数据存储在各种持久化存储中，例如关系型数据库、NoSQL 数据库等。

使用 Spring Session，无论使用何种持久化存储，你都可以使用相同的 API 来管理会话。这使得在不同存储之间切换变得更加容易，而无需修改应用程序代码。Spring Session 还提供了诸如会话过期、跨上下文通信等特性。

总体而言，Spring Session 简化了 Web 应用程序中用户会话的管理，让你可以更专注于构建应用程序的核心功能。

以下是 Spring Session 的一些常见使用场景：

- 分布式 Web 应用程序：如果你的 Web 应用程序部署在多个服务器上，管理用户会话将变得困难。Spring Session 可以通过将会话数据存储在共享数据库或 Redis 中，让所有服务器都能访问和更新会话数据。
- 会话可扩展性：在具有大量并发用户的大型 Web 应用程序中，将会话存储在服务器内存中可能导致可扩展性问题。Spring Session 允许将会话数据存储在持久化存储中，从而提高可扩展性，并降低内存溢出的风险。
- 会话备份与恢复：将会话数据存储在持久化存储中还可以在服务器故障或停机时提供一种备份和恢复会话数据的机制。

[[community]]
== Spring Session 社区

我们很高兴地认为你是我们社区的一员。以下部分介绍了如何与 Spring Session 社区进行互动。

[[community-support]]
=== 支持

你可以通过在 https://stackoverflow.com/questions/tagged/spring-session[Stack Overflow 上使用 `spring-session` 标签提问] 来获得帮助。同样，我们也鼓励你通过回答 Stack Overflow 上的问题来帮助他人。

[[community-source]]
=== 源码

你可以在 GitHub 上找到源码：https://github.com/spring-projects/spring-session/

[[community-issues]]
=== 问题追踪

我们在 GitHub Issues 中跟踪问题：https://github.com/spring-projects/spring-session/issues

[[community-contributing]]
=== 贡献

我们欢迎 https://help.github.com/articles/using-pull-requests/[Pull Requests]。

[[community-license]]
=== 许可证

Spring Session 是根据 https://www.apache.org/licenses/LICENSE-2.0[Apache 2.0 许可证]发布的开源软件。

[[community-extensions]]
=== 社区扩展

|===
| 名称 | 位置

| Spring Session Infinispan
| https://infinispan.org/docs/stable/titles/spring/spring.html

| Spring Session Caffeine
| https://github.com/gotson/spring-session-caffeine

|===

[[minimum-requirements]]
== 最低要求

Spring Session 的最低要求如下：

* Java 17 或更高版本。
* 如果你在 Servlet 容器中运行（非必需），需要 Servlet 3.1 或以上版本。
* 如果你使用其他 Spring 库（非必需），最低所需版本为 Spring 6.0.x。
* `@EnableRedisHttpSession` 需要 Redis 2.8+，这是为了支持 xref:api.adoc#api-redisindexedsessionrepository-expiration[会话过期] 功能。
* `@EnableHazelcastHttpSession` 需要 Hazelcast 3.6+，这是为了支持 xref:api.adoc#api-enablehazelcasthttpsession-storage[`FindByIndexNameSessionRepository`]。

NOTE: Spring Session 的核心仅对 `spring-jcl` 有强制依赖。有关在不使用其他 Spring 依赖的情况下使用 Spring Session 的示例，请参阅 xref:samples.adoc#samples[hazelcast 示例] 应用程序。